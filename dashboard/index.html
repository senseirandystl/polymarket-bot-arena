<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polymarket Bot Arena</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #0d1117; color: #c9d1d9; font-family: 'SF Mono', 'Fira Code', monospace; font-size: 14px; }
.header { background: #161b22; border-bottom: 1px solid #30363d; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
.header h1 { font-size: 18px; color: #f0f6fc; }
.mode-badge { padding: 6px 16px; border-radius: 20px; font-weight: bold; font-size: 13px; cursor: pointer; border: none; }
.mode-paper { background: #238636; color: #fff; }
.mode-live { background: #da3633; color: #fff; }
.container { max-width: 1400px; margin: 0 auto; padding: 20px; }
.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; margin-bottom: 20px; }
.card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 16px; }
.card h2 { font-size: 14px; color: #8b949e; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
.stat-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
.stat-label { color: #8b949e; }
.stat-value { color: #f0f6fc; font-weight: bold; }
.positive { color: #3fb950; }
.negative { color: #f85149; }
.neutral { color: #8b949e; }
.bot-card { border-left: 3px solid #58a6ff; }
.bot-card.top { border-left-color: #3fb950; }
.bot-name { font-size: 16px; color: #58a6ff; margin-bottom: 4px; }
.bot-meta { color: #8b949e; font-size: 12px; margin-bottom: 12px; }
.trade-list { max-height: 200px; overflow-y: auto; }
.trade-item { padding: 4px 0; border-bottom: 1px solid #21262d; font-size: 12px; display: flex; justify-content: space-between; }
.progress-bar { background: #21262d; border-radius: 4px; height: 8px; margin-top: 4px; }
.progress-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
.sparkline { height: 40px; display: flex; align-items: flex-end; gap: 2px; }
.spark-bar { width: 4px; min-height: 2px; background: #58a6ff; border-radius: 1px; }
.spark-bar.neg { background: #f85149; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th { text-align: left; color: #8b949e; padding: 8px 4px; border-bottom: 1px solid #30363d; }
td { padding: 6px 4px; border-bottom: 1px solid #21262d; }
.section-title { font-size: 16px; color: #f0f6fc; margin: 24px 0 12px; }
.confirm-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; }
.confirm-modal.active { display: flex; }
.confirm-box { background: #161b22; border: 1px solid #da3633; border-radius: 12px; padding: 32px; max-width: 400px; text-align: center; }
.confirm-box h3 { color: #f85149; margin-bottom: 16px; }
.confirm-box p { margin-bottom: 20px; color: #8b949e; }
.btn { padding: 8px 20px; border-radius: 6px; border: none; cursor: pointer; font-family: inherit; font-size: 14px; margin: 4px; }
.btn-danger { background: #da3633; color: #fff; }
.btn-cancel { background: #30363d; color: #c9d1d9; }
.refresh-info { color: #484f58; font-size: 11px; text-align: right; margin-top: 8px; }
.bot-mode-btn { padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; cursor: pointer; border: none; font-family: inherit; }
.bot-mode-paper { background: #238636; color: #fff; }
.bot-mode-live { background: #da3633; color: #fff; }
.bot-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.bot-balance { color: #8b949e; font-size: 12px; }
.market-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #21262d; }
.market-row:last-child { border-bottom: none; }
....(truncated 13405 characters)...ner.innerHTML = '';
        return;
    }
    noMarkets.style.display = 'none';

    container.innerHTML = withTimes.map(m => {
        const remaining = m.endTime.getTime() - now;
        const countdown = formatCountdown(remaining);
        let timerClass = 'normal';
        if (remaining < 60000) timerClass = 'urgent';
        else if (remaining < 180000) timerClass = 'warning';

        const price = m.current_price ? (m.current_price * 100).toFixed(1) + '%' : '-';
        // Shorten question for display
        const shortQ = m.question.replace('Bitcoin Up or Down - ', '');
        return `<div class="market-row">
            <span class="market-question">${shortQ}</span>
            <span class="market-price">YES ${price}</span>
            <span class="market-timer ${timerClass}">${countdown}</span>
        </div>`;
    }).join('');
}

async function fetchMarkets() {
    try {
        const response = await fetch(`/api/markets?page=${currentPage}&limit=${limit}`);
        const data = await response.json();
        activeMarkets = data.markets;
        if (activeMarkets.error) activeMarkets = [];
        
        // Update pagination buttons
        document.getElementById('prev-btn').disabled = currentPage === 1;
        document.getElementById('next-btn').disabled = currentPage >= data.pages;
    } catch(e) { activeMarkets = []; }
}

function prevPage() { if (currentPage > 1) { currentPage--; fetchMarkets(); updateMarketTimers(); } }
function nextPage() { currentPage++; fetchMarkets(); updateMarketTimers(); }

function updateMode(mode) {
    currentMode = mode;
    const btn = document.getElementById('mode-btn');
    btn.textContent = mode.toUpperCase();
    btn.className = 'mode-badge mode-' + mode;
}

function toggleMode() {
    if (currentMode === 'paper') {
        document.getElementById('confirm-modal').classList.add('active');
    } else {
        fetch('/api/mode', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({mode: 'paper'}) })
            .then(r => r.json()).then(d => updateMode(d.mode));
    }
}

function confirmLive() {
    fetch('/api/mode', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({mode: 'live'}) })
        .then(r => r.json()).then(d => { updateMode(d.mode); cancelModal(); });
}

function cancelModal() {
    document.getElementById('confirm-modal').classList.remove('active');
}

let pendingBotToggle = null;

function toggleBotMode(botName, currentMode) {
    if (currentMode === 'paper') {
        pendingBotToggle = botName;
        document.getElementById('bot-confirm-name').textContent = botName;
        document.getElementById('bot-confirm-modal').classList.add('active');
    } else {
        fetch(`/api/bots/${botName}/mode`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({mode: 'paper'})
        }).then(() => refresh());
    }
}

function confirmBotLive() {
    if (pendingBotToggle) {
        fetch(`/api/bots/${pendingBotToggle}/mode`, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({mode: 'live'})
        }).then(() => { cancelBotModal(); refresh(); });
    }
}

function cancelBotModal() {
    pendingBotToggle = null;
    document.getElementById('bot-confirm-modal').classList.remove('active');
}

async function refresh() {
    try {
        const [status, overview, bots, evolution, trades, earnings] = await Promise.all([
            fetchJSON('/api/status'),
            fetchJSON('/api/overview'),
            fetchJSON('/api/bots'),
            fetchJSON('/api/evolution'),
            fetchJSON('/api/trades?limit=20'),
            fetchJSON('/api/earnings'),
        ]);
        updateMode(status.mode);
        updateOverview(overview.stats);
        updateBots(bots);
        updateEvolution(evolution);
        updateTrades(trades);
        updateEarnings(earnings);
    } catch (e) {
        console.error('Refresh error:', e);
    }
    // Refresh market data alongside other data
    await fetchMarkets();
    updateMarketTimers();
}

refresh();
setInterval(refresh, 10000);
// Tick countdown every second for smooth timers
setInterval(updateMarketTimers, 1000);
</script>

<!-- Add buttons in HTML -->
<button id="prev-btn" onclick="prevPage()">Previous</button>
<button id="next-btn" onclick="nextPage()">Next</button>

</body>
</html>
